<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="{% static 'img/BB_LOGO_V2.png' %}" type="image/x-icon">
    <title>Blossom ERP - Dashboard</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
  <link href="{% static 'glightbox/glightbox.min.css' %}" rel="stylesheet">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

</head>

<body>

    <!-- Universal Page Loader -->
    <div class="page-loader" id="pageLoader">
        <div class="loader-content">
            <div class="logo-spinner">
                <div class="spinner-ring"></div>
                <div class="logo-center">
                    <!-- Use your actual logo -->
                    <img src="{% static 'img/BB_LOGO_V2.png' %}" alt="BB Logo"
                        onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="logo-placeholder" style="display: none;">BB</div>
                </div>
                <div class="butterflies">
                    <div class="butterfly"><i class="fas fa-butterfly"></i></div>
                    <div class="butterfly"><i class="fas fa-butterfly"></i></div>
                    <div class="butterfly"><i class="fas fa-butterfly"></i></div>
                    <div class="butterfly"><i class="fas fa-butterfly"></i></div>
                </div>
            </div>
            <div class="loading-text">Loading...</div>
            <div class="loading-subtitle">Please wait</div>
            <div class="loading-dots">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
        </div>
    </div>
    <!-- Top Navigation Bar -->
    <!-- ADD THIS TOP BAR BEFORE YOUR EXISTING NAV -->
    <!-- <div class="" style="position: fixed;z-index: 1050 !important;right:10px;top:15px;">
        <button class="nav-toggle-btn" style="color: #D54395;" onclick="toggleMainNav()">
            <i class="fas fa-eye"></i>
        </button>
    </div> -->


    <!-- <nav class="top-nav">
        <div class="nav-container">
            <div class="nav-left">
                <div class="logo" style="background-color: white;padding: 5px; border-radius: 10px;">
                    <div class="logo-icon bg-white">
                        <img src="{% static 'img/BB_LOGO_V1.png' %}" style="max-width: 100px;" alt="">
                    </div>

                </div>
                
                <button class="mobile-nav-toggle" id="mobileToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="nav-menu">
                    <div class="nav-item dropdown">
                        <a href="{% url 'index'%}" class="nav-link">
                            <i class="fas fa-tachometer-alt"></i>
                            Dashboard
                        </a>
                    </div>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle">
                            <i class="fas fa-users"></i>
                            Students
                            <i class="fas fa-chevron-down"></i>
                        </a>
                        <div class="dropdown-menu">
                            <a href="{% url 'student_create' %}" class="dropdown-item"><i class="fas fa-user-plus"></i> Add Student</a>
                            <a href="{% url 'students' %}" class="dropdown-item"><i class="fas fa-list"></i> All Students</a>
                            <a href="#" class="dropdown-item"><i class="fas fa-search"></i> Search Student</a>
                        </div>
                    </div>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle">
                            <i class="fas fa-credit-card"></i>
                            Payments
                            <i class="fas fa-chevron-down"></i>
                        </a>
                        <div class="dropdown-menu">
                            <a href="#" class="dropdown-item"><i class="fas fa-dollar-sign"></i> Fee Collection</a>
                            <a href="#" class="dropdown-item"><i class="fas fa-receipt"></i> Generate Receipt</a>
                            <a href="#" class="dropdown-item"><i class="fas fa-exclamation-triangle"></i> Outstanding
                                Fees</a>
                        </div>
                    </div>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle">
                            <i class="fas fa-chart-bar"></i>
                            Reports
                            <i class="fas fa-chevron-down"></i>
                        </a>
                        <div class="dropdown-menu">
                            <a href="#" class="dropdown-item"><i class="fas fa-file-pdf"></i> Financial Reports</a>
                            <a href="#" class="dropdown-item"><i class="fas fa-users"></i> Student Reports</a>
                            <a href="#" class="dropdown-item"><i class="fas fa-bus"></i> Transport Reports</a>
                        </div>
                    </div>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle">
                            <i class="fas fa-cog"></i>
                            Settings
                            <i class="fas fa-chevron-down"></i>
                        </a>
                        <div class="dropdown-menu">
                            <a href="#" class="dropdown-item"><i class="fas fa-user-cog"></i> User Management</a>
                            <a href="#" class="dropdown-item"><i class="fas fa-school"></i> School Settings</a>
                            <a href="#" class="dropdown-item"><i class="fas fa-backup"></i> Backup & Restore</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="nav-right">
                <div class="nav-item">
                    <a href="#" class="nav-link notification-link">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">3</span>
                    </a>
                </div>
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle user-menu">
                        {% if user.avatar %}
                        <img src="{{ user.avatar.url }}" alt="User" class="user-avatar">
                        {% else %}
                        <img src="{% static 'img/userplaceholder.png' %}" alt="User" class="user-avatar">
                        {% endif %}
                        <span>{{ user.first_name }}</span>
                        <i class="fas fa-chevron-down"></i>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right">
                        <a href="{% url 'profile' %}" class="dropdown-item"><i class="fas fa-user"></i> Profile</a>
                        <div class="dropdown-divider"></div>
                        <a href="{% url 'signout' %}" class="dropdown-item"><i class="fas fa-sign-out-alt"></i>
                            Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </nav> -->


 <nav class="navbar navbar-expand-lg custom-navbar sticky-top">
    <div class="container-fluid px-4">
        <!-- Logo -->
        <a class="navbar-brand" href="{% url 'index' %}">
            <img src="{% static 'img/BB_LOGO_V1.png' %}" alt="Blossom British"  style="max-width: 100px;">
        </a>

        <!-- Mobile Toggle -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false">
            <i class="fas fa-bars text-white"></i>
        </button>

        <!-- Navigation Menu -->
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto ms-4">
                <!-- Dashboard -->
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'index' %}">
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard
                    </a>
                </li>

                <!-- Students -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-users"></i>
                        Students
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{% url 'student_create' %}">
                            <i class="fas fa-user-plus"></i> Add Student
                        </a></li>
                        <li><a class="dropdown-item" href="{% url 'students' %}">
                            <i class="fas fa-list"></i> All Students
                        </a></li>
                        <li><a class="dropdown-item" href="#">
                            <i class="fas fa-search"></i> Search Student
                        </a></li>
                    </ul>
                </li>

                <!-- Payments -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-credit-card"></i>
                        Payments
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            <a class="dropdown-item" href="{% url 'payment_dashboard' %}"><i class="fas fa-tachometer-alt"></i> Payment Dashboard</a>
                        </li>
                        <li><a class="dropdown-item" href="{% url 'create_payment' %}">
                            <i class="fas fa-dollar-sign"></i> Fee Collection
                        </a></li>
                        <!-- <li><a class="dropdown-item" href="#">
                            <i class="fas fa-receipt"></i> Generate Receipt
                        </a></li>
                        <li><a class="dropdown-item" href="#">
                            <i class="fas fa-exclamation-triangle"></i> Outstanding Fees
                        </a></li> -->
                    </ul>
                </li>

                <!-- Reports -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-briefcase"></i> Finance 

                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{%url 'income'%}">
                            <i class="fas fa-hand-holding-usd"></i> Income

                        </a></li>
                        <li><a class="dropdown-item" href="{%url 'expense' %}">
                           <i class="fas fa-money-bill-wave"></i> Expense

                        </a></li>
                        <li><a class="dropdown-item" href="{%url 'balance_sheet' %}">
                           <i class="fas fa-chart-line"></i> Balance Sheet

                        </a></li>
                    </ul>
                </li>

                <!-- Settings -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-cog"></i>
                        Utilities
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{% url 'teacher_list' %}">
                            <i class="fas fa-user-cog"></i> Staff Management
                        </a></li>
                        <li><a class="dropdown-item" href="{% url 'attendance_dashboard' %}">
                            <i class="fas fa-calendar"></i> Attendance Management
                        </a></li>
                         <li><a class="dropdown-item" href="{% url 'salary_dashboard' %}">
                            <i class="fas fa-money-bill-wave"></i> Salary Management
                        </a></li>
                        <li><a class="dropdown-item" href="{% url 'site_setting' %}">
                            <i class="fas fa-school"></i> School Settings
                        </a></li>
                        
                       
                    </ul>
                </li>
            </ul>

            <!-- Right Side Menu -->
            <ul class="navbar-nav ms-auto">
                <!-- Notifications -->
                <!-- <li class="nav-item">
                    <a class="nav-link notification-link" href="#">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">3</span>
                    </a>
                </li> -->

                <!-- User Menu -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle user-menu text-white" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        {% if user.avatar %}
                            <img src="{{ user.avatar.url }}" alt="User" class="user-avatar">
                        {% else %}
                            <img src="{% static 'img/userplaceholder.png' %}" alt="User" class="user-avatar">
                        {% endif %}
                        <span class="user-name">{{ user.username }}</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="{% url 'profile' %}">
                            <i class="fas fa-user"></i> Profile
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{% url 'signout' %}">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a></li>
                         <li><a class="dropdown-item" href="#">
                            <i class="fas fa-cloud-upload-alt"></i> Backup & Restore
                        </a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="dashboard-container">

            {% block content %}
            <!-- Page Header -->
            <div class="page-header">
                <h1>Dashboard Overview</h1>
                <p>Welcome back! Here's what's happening at your nursery today.</p>
            </div>

            <!-- Statistics Cards -->
            <div class="stats-grid">
                <div class="stat-card primary">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <h3>245</h3>
                        <p>Total Students</p>
                        <span class="stat-change positive">+12 this month</span>
                    </div>
                </div>
                <div class="stat-card secondary">
                    <div class="stat-icon">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <div class="stat-content">
                        <h3>18</h3>
                        <p>New Admissions</p>
                        <span class="stat-change positive">+5 this week</span>
                    </div>
                </div>
                <div class="stat-card accent">
                    <div class="stat-icon">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="stat-content">
                        <h3>â‚¹85,400</h3>
                        <p>Fees Collected</p>
                        <span class="stat-change positive">+15% vs last month</span>
                    </div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-content">
                        <h3>12</h3>
                        <p>Outstanding Payments</p>
                        <span class="stat-change negative">-3 from last week</span>
                    </div>
                </div>
            </div>

            <!-- Charts and Recent Activity -->
            <div class="dashboard-grid">
                <!-- Revenue Chart -->
                <div class="dashboard-card large">
                    <div class="card-header">
                        <h3>Monthly Revenue Overview</h3>
                        <div class="card-actions">
                            <select class="form-select">
                                <option>Last 6 Months</option>
                                <option>Last Year</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="chart-container">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Recent Activities -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3>Recent Activities</h3>
                        <a href="#" class="view-all">View All</a>
                    </div>
                    <div class="card-content">
                        <div class="activity-list">
                            <div class="activity-item">
                                <div class="activity-icon new">
                                    <i class="fas fa-user-plus"></i>
                                </div>
                                <div class="activity-content">
                                    <p><strong>Sarah Johnson</strong> admitted to Nursery A</p>
                                    <span class="activity-time">2 hours ago</span>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon payment">
                                    <i class="fas fa-credit-card"></i>
                                </div>
                                <div class="activity-content">
                                    <p><strong>Mike Wilson</strong> paid monthly fees</p>
                                    <span class="activity-time">4 hours ago</span>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon warning">
                                    <i class="fas fa-exclamation-circle"></i>
                                </div>
                                <div class="activity-content">
                                    <p>Fee reminder sent to <strong>Emma Davis</strong></p>
                                    <span class="activity-time">1 day ago</span>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon transport">
                                    <i class="fas fa-bus"></i>
                                </div>
                                <div class="activity-content">
                                    <p><strong>Alex Brown</strong> registered for transport</p>
                                    <span class="activity-time">2 days ago</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3>Quick Actions</h3>
                    </div>
                    <div class="card-content">
                        <div class="quick-actions">
                            <a href="#" class="action-btn primary">
                                <i class="fas fa-user-plus"></i>
                                <span>Add New Student</span>
                            </a>
                            <a href="#" class="action-btn secondary">
                                <i class="fas fa-credit-card"></i>
                                <span>Collect Payment</span>
                            </a>
                            <a href="#" class="action-btn accent">
                                <i class="fas fa-file-pdf"></i>
                                <span>Generate Report</span>
                            </a>
                            <a href="#" class="action-btn warning">
                                <i class="fas fa-bell"></i>
                                <span>Send Reminders</span>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Fee Collection Summary -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3>Fee Collection Summary</h3>
                        <span class="period-badge">This Month</span>
                    </div>
                    <div class="card-content">
                        <div class="fee-summary">
                            <div class="fee-item">
                                <div class="fee-label">
                                    <span class="fee-dot collected"></span>
                                    Collected
                                </div>
                                <div class="fee-amount">AED 85,400</div>
                                <div class="fee-percentage">68%</div>
                            </div>
                            <div class="fee-item">
                                <div class="fee-label">
                                    <span class="fee-dot pending"></span>
                                    Pending
                                </div>
                                <div class="fee-amount">AED 40,200</div>
                                <div class="fee-percentage">32%</div>
                            </div>
                            <div class="fee-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 68%"></div>
                                </div>
                            </div>
                            <p class="fee-target">Target: AED 125,600</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Upcoming Events & Calendar -->
            <div class="dashboard-grid-bottom">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3>Upcoming Events</h3>
                        <a href="#" class="add-event">
                            <i class="fas fa-plus"></i>
                        </a>
                    </div>
                    <div class="card-content">
                        <div class="events-list">
                            <div class="event-item">
                                <div class="event-date">
                                    <span class="day">25</span>
                                    <span class="month">Nov</span>
                                </div>
                                <div class="event-details">
                                    <h4>Parent-Teacher Meeting</h4>
                                    <p>Annual PTM for all classes</p>
                                    <span class="event-time">2:00 PM - 5:00 PM</span>
                                </div>
                            </div>
                            <div class="event-item">
                                <div class="event-date">
                                    <span class="day">30</span>
                                    <span class="month">Nov</span>
                                </div>
                                <div class="event-details">
                                    <h4>Monthly Fee Due</h4>
                                    <p>December fee collection starts</p>
                                    <span class="event-time">All Day</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <h3>Class Distribution</h3>
                    </div>
                    <div class="card-content">
                        <div class="class-distribution">
                            <div class="class-item">
                                <div class="class-info">
                                    <span class="class-name">Nursery A</span>
                                    <span class="class-count">45 students</span>
                                </div>
                                <div class="class-progress">
                                    <div class="progress-bar small">
                                        <div class="progress-fill primary" style="width: 90%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="class-item">
                                <div class="class-info">
                                    <span class="class-name">Nursery B</span>
                                    <span class="class-count">42 students</span>
                                </div>
                                <div class="class-progress">
                                    <div class="progress-bar small">
                                        <div class="progress-fill secondary" style="width: 84%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="class-item">
                                <div class="class-info">
                                    <span class="class-name">Pre-KG</span>
                                    <span class="class-count">38 students</span>
                                </div>
                                <div class="class-progress">
                                    <div class="progress-bar small">
                                        <div class="progress-fill accent" style="width: 76%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <script>
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', function () {
                        console.log('Nursery ERP Dashboard initialized successfully!');
                        showToast('Dashboard loaded successfully!', 'success');
                    });
                } else {
                    console.log('Nursery ERP Dashboard initialized successfully!');
                }
            </script>
            {% endblock %}

        </div>
    </main>



    <!-- scripts  -->
      <script src="{% static 'glightbox/glightbox.min.js' %}"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'script/script.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        class UniversalLoader {
            constructor() {
                this.loader = document.getElementById('pageLoader');
                this.mainContent = document.getElementById('mainContent');
                this.loadingText = document.querySelector('.loading-text');
                this.loadingSubtitle = document.querySelector('.loading-subtitle');
                this.isLoading = true;
                this.minLoadTime = 800; // Minimum loading time in ms
                this.startTime = Date.now();

                this.init();
            }

            init() {
                // Set initial loading message based on page
                this.setLoadingMessage();

                // Start loading process
                this.startLoading();

                // Hide loader when page is fully loaded
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', () => this.checkComplete());
                    window.addEventListener('load', () => this.checkComplete());
                } else {
                    this.checkComplete();
                }
            }

            setLoadingMessage() {
                const path = window.location.pathname;
                let message = 'Loading...';
                let subtitle = 'Please wait';

                if (path.includes('dashboard')) {
                    message = 'Preparing Dashboard';
                    subtitle = 'Setting up your workspace';
                } else if (path.includes('students')) {
                    message = 'Loading Students';
                    subtitle = 'Fetching student data';
                } else if (path.includes('payments')) {
                    message = 'Loading Payments';
                    subtitle = 'Processing financial data';
                } else if (path.includes('reports')) {
                    message = 'Generating Reports';
                    subtitle = 'Compiling information';
                } else if (path.includes('login')) {
                    message = 'Welcome Back';
                    subtitle = 'Preparing login';
                } else {
                    message = 'Loading Page';
                    subtitle = 'Almost ready';
                }

                this.loadingText.textContent = message;
                this.loadingSubtitle.textContent = subtitle;
            }

            startLoading() {
                // Show loader
                this.loader.classList.remove('hidden');
                this.mainContent.style.opacity = '0';

                // Prevent scroll during loading
                document.body.style.overflow = 'hidden';
            }

            checkComplete() {
                if (!this.isLoading) return;

                const elapsed = Date.now() - this.startTime;
                const remainingTime = Math.max(0, this.minLoadTime - elapsed);

                setTimeout(() => {
                    this.hideLoader();
                }, remainingTime);
            }

            hideLoader() {
                this.isLoading = false;

                // Update loading message
                this.loadingText.textContent = 'Ready!';
                this.loadingSubtitle.textContent = 'Welcome to Blossom British';

                setTimeout(() => {
                    // Hide loader with animation
                    this.loader.classList.add('hidden');
                    this.mainContent.style.opacity = '1';

                    // Re-enable scroll
                    document.body.style.overflow = '';

                    // Remove loader from DOM after animation
                    setTimeout(() => {
                        if (this.loader.parentNode) {
                            this.loader.remove();
                        }
                    }, 500);
                }, 300);
            }

            // Method to show loader programmatically (for AJAX calls)
            show(message = 'Loading...', subtitle = 'Please wait') {
                if (!this.loader.parentNode) {
                    // Re-create loader if it was removed
                    location.reload();
                    return;
                }

                this.loadingText.textContent = message;
                this.loadingSubtitle.textContent = subtitle;
                this.loader.classList.remove('hidden');
                this.mainContent.style.opacity = '0.3';
                document.body.style.overflow = 'hidden';
                this.isLoading = true;
            }

            // Method to hide loader programmatically
            hide() {
                if (!this.isLoading) return;

                setTimeout(() => {
                    this.hideLoader();
                }, 200);
            }
        }

        // Initialize loader
        const universalLoader = new UniversalLoader();

        // Make loader accessible globally for AJAX calls
        window.loader = {
            show: (message, subtitle) => universalLoader.show(message, subtitle),
            hide: () => universalLoader.hide()
        };

        // Auto-show loader for form submissions
        document.addEventListener('submit', function (e) {
            const form = e.target;
            if (form.tagName === 'FORM') {
                window.loader.show('Processing...', 'Submitting your request');
            }
        });

        // Auto-show loader for navigation links (optional)
        document.addEventListener('click', function (e) {
            const link = e.target.closest('a[href]');
            if (link && link.href && !link.href.startsWith('#') && !link.href.startsWith('javascript:') && !link.hasAttribute('download') && !link.target) {
                // Only show for internal navigation
                if (link.href.includes(window.location.origin)) {
                    window.loader.show('Navigating...', 'Loading page');
                }
            }
        });

    </script>
    <script>
        // Force hide loader after 2 seconds (emergency fallback)
        setTimeout(() => {
            const loader = document.getElementById('pageLoader');
            if (loader) {
                loader.classList.add('hidden');
                document.getElementById('mainContent').style.opacity = '1';
                document.body.style.overflow = '';
            }
        }, 2000);
    </script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    {% if messages %}
    <script>
        // Custom CSS for Blossom British themed alerts
        const blossomTheme = `
        .swal2-popup {
        background: linear-gradient(135deg, #F8F6FF 0%, #E8DFFF 50%, #F3EBFF 100%) !important;
        border-radius: 20px !important;
        border: 3px solid transparent !important;
        background-clip: padding-box !important;
        box-shadow: 0 15px 35px rgba(33, 72, 136, 0.15), 0 5px 15px rgba(0, 0, 0, 0.08) !important;
        font-family: 'Poppins', sans-serif !important;
        position: relative !important;
        overflow: hidden !important;
        }
        
        .swal2-popup::before {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(45deg, #214888, #D54395, #8B5FBF, #4ECDC4);
        border-radius: 22px;
        z-index: -1;
        animation: borderRotate 3s linear infinite;
        }
        
        @keyframes borderRotate {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
        }
        
        .swal2-title {
        color: #214888 !important;
        font-weight: 600 !important;
        font-size: 20px !important;
        margin-bottom: 15px !important;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
        }
        
        .swal2-icon {
        border: none !important;
        margin: 20px auto 15px !important;
        position: relative !important;
        }
        
        .swal2-icon::before {
        content: 'âœ¨';
        position: absolute;
        top: -10px;
        right: -10px;
        font-size: 16px;
        animation: sparkle 2s ease-in-out infinite;
        }
        
        .swal2-icon.swal2-success {
        background: linear-gradient(135deg, #4ECDC4, #FFD700) !important;
        color: white !important;
        }
        
        .swal2-icon.swal2-error {
        background: linear-gradient(135deg, #FF6B6B, #D54395) !important;
        color: white !important;
        }
        
        .swal2-icon.swal2-warning {
        background: linear-gradient(135deg, #FFD700, #FF6B6B) !important;
        color: white !important;
        }
        
        .swal2-icon.swal2-info {
        background: linear-gradient(135deg, #214888, #8B5FBF) !important;
        color: white !important;
        }
        
        .swal2-confirm {
        background: linear-gradient(135deg, #214888 0%, #D54395 100%) !important;
        border: none !important;
        border-radius: 25px !important;
        padding: 12px 30px !important;
        font-weight: 600 !important;
        font-size: 14px !important;
        color: white !important;
        box-shadow: 0 5px 15px rgba(33, 72, 136, 0.3) !important;
        transition: all 0.3s ease !important;
        }
        
        .swal2-confirm:hover {
        transform: translateY(-2px) !important;
        box-shadow: 0 8px 25px rgba(33, 72, 136, 0.4) !important;
        }
        
        .swal2-container {
        backdrop-filter: blur(10px) !important;
        background: rgba(248, 246, 255, 0.3) !important;
        }
        
        @keyframes sparkle {
        0%, 100% { opacity: 1; transform: scale(1) rotate(0deg); }
        50% { opacity: 0.7; transform: scale(1.2) rotate(180deg); }
        }
        
        .floating-butterflies {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        overflow: hidden;
        }
        
        .butterfly-float {
        position: absolute;
        color: #D54395;
        font-size: 16px;
        opacity: 0.6;
        animation: butterflyFloat 4s ease-in-out infinite;
        }
        
        .butterfly-float:nth-child(1) {
        top: 20%;
        left: 10%;
        animation-delay: 0s;
        color: #FFD700;
        }
        
        .butterfly-float:nth-child(2) {
        top: 70%;
        right: 15%;
        animation-delay: -2s;
        color: #4ECDC4;
        }
        
        @keyframes butterflyFloat {
        0%, 100% { transform: translateY(0px) translateX(0px) rotate(0deg); }
        25% { transform: translateY(-10px) translateX(5px) rotate(5deg); }
        50% { transform: translateY(-5px) translateX(-8px) rotate(-3deg); }
        75% { transform: translateY(-15px) translateX(3px) rotate(7deg); }
        }
    `;

        // Inject custom styles
        const style = document.createElement('style');
        style.textContent = blossomTheme;
        document.head.appendChild(style);

        '{% for message in messages %}'
        // Add floating butterflies to the alert
        const butterflyHTML = `
        <div class="floating-butterflies">
            <div class="butterfly-float">ðŸ¦‹</div>
            <div class="butterfly-float">ðŸ¦‹</div>
        </div>
        `;

        Swal.fire({
            icon: "{% if message.tags == 'success' %}success{% elif message.tags == 'error' %}error{% elif message.tags == 'warning' %}warning{% else %}info{% endif %}",
            title: "{{ message|escapejs }}",
            html: butterflyHTML,
            showConfirmButton: true,
            confirmButtonText: 'âœ¨ Got it!',
            timer: 4000,
            timerProgressBar: true,
            allowEscapeKey: true,
            allowOutsideClick: true,
            showClass: {
                popup: 'animate__animated animate__bounceIn animate__faster'
            },
            hideClass: {
                popup: 'animate__animated animate__fadeOutUp animate__faster'
            },
            customClass: {
                popup: 'blossom-alert',
                title: 'blossom-title',
                confirmButton: 'blossom-button'
            }
        });
        '{% endfor %}'
    </script>
    {% endif %}

</body>

</html>